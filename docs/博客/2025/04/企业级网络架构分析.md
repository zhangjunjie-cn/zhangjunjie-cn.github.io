---
firstCommit: 2025/04/13 21:07:00

title: ä¼ä¸šçº§ç½‘ç»œæ¶æ„åˆ†æ
description: ç®€å•æ¢è®¨ä¸‰å±‚äº¤æ¢æœºçš„ç”¨æ³•çš„ï¼Œæœ‰æ„ä¹‰ä¹Ÿä¸å¤§ï¼Œä½†æ˜¯æˆ‘æ¥æ—¶çš„è·¯ã€‚
tags:
 - äº¤æ¢æœº
---

# ä¼ä¸šçº§ç½‘ç»œæ¶æ„åˆ†æ

## **ä¼ä¸šçº§ç½‘ç»œæ¶æ„åˆ†æ**

```mermaid
graph TB
    %% å®šä¹‰æ ·å¼
    classDef access fill:#D1C4E9,stroke:#7E57C2;
    classDef trunk fill:#E1F5FE,stroke:#039BE5;
    classDef core fill:#FFECB3,stroke:#FFA000;
    classDef router fill:#C8E6C9,stroke:#388E3C;
    classDef logical stroke-dasharray:5,5,stroke:#F44336,fill:#FFEBEE;

    %% ç‰©ç†æ‹“æ‰‘
    A1[æ¥å…¥äº¤æ¢æœº1<br/>G0/0/1:Trunk]:::trunk -- G0/0/1 --> CORE[æ ¸å¿ƒäº¤æ¢æœº-HW-S7700]:::core
    A2[æ¥å…¥äº¤æ¢æœº2<br/>G0/0/1:Trunk]:::trunk -- G0/0/2 --> CORE
    CORE -- G0/0/24 --> R[å‡ºå£è·¯ç”±å™¨]:::router

    %% ç»ˆç«¯è®¾å¤‡
    PC1[PC1<br/>VLAN10]:::access -- Access VLAN10 --> A1
    CAM1[æ‘„åƒå¤´1<br/>VLAN20]:::access -- Access VLAN20 --> A2

    %% é€»è¾‘åŠŸèƒ½ï¼ˆè™šçº¿æ¡†è¡¨ç¤ºï¼‰
    subgraph æ ¸å¿ƒäº¤æ¢æœºé€»è¾‘åŠŸèƒ½
        classDef logical stroke-dasharray:5,5,stroke:#F44336,fill:#FFEBEE
        V10[Vlanif10<br/>192.168.10.1/24]:::logical
        V20[Vlanif20<br/>192.168.20.1/24]:::logical
        ROUTE[é™æ€è·¯ç”±<br/>0.0.0.0/0â†’192.168.1.254]:::logical
    end

    %% æ•°æ®æµè·¯å¾„
    CORE -.-> V10 & V20 & ROUTE
    PC1 -->|1.è®¿é—®è¯·æ±‚| A1 -->|2.å¸¦VLAN10æ ‡ç­¾| CORE
    CORE -->|3.è·¯ç”±åˆ°VLAN20| A2 -->|4.è½¬å‘| CAM1
```

> æ ¹æ®Mermaidå›¾ä¸­çš„æ‹“æ‰‘ç»“æ„ï¼ˆ1å°æ ¸å¿ƒäº¤æ¢æœº+2å°æ¥å…¥äº¤æ¢æœºï¼‰åˆ†åˆ«ç»™å‡ºé…ç½®æ–¹æ¡ˆã€‚ä»¥ä¸‹æ˜¯å®Œå…¨åŒ¹é…æ‚¨æ¶æ„çš„è¯¦ç»†é…ç½®æ¸…å•ï¼š

---

### **ç½‘ç»œæ¶æ„å›é¡¾**
```mermaid
graph TB
    A1[æ¥å…¥äº¤æ¢æœº1] --Trunk--> CORE[æ ¸å¿ƒäº¤æ¢æœº]
    A2[æ¥å…¥äº¤æ¢æœº2] --Trunk--> CORE
    CORE --VLANIF30--> R[è·¯ç”±å™¨]
    PC1 --VLAN10--> A1
    CAM1 --VLAN20--> A2
```

---

### **æ ¸å¿ƒäº¤æ¢æœºé…ç½® (Huawei S7700)**
```bash
# åŸºç¡€é…ç½®
sysname CORE-SW
vlan batch 10 20 30  # åˆ›å»ºä¸šåŠ¡VLANå’Œç®¡ç†VLAN

# VLANIFä¸‰å±‚æ¥å£
interface Vlanif10
 description Office_Users
 ip address 192.168.10.1 24
 dhcp select interface
 dhcp server dns-list 114.114.114.114 223.5.5.5
 dhcp server excluded-ip-address 192.168.10.1 192.168.10.50  # ä¿ç•™å‰50ä¸ªIP
quit

interface Vlanif20
 description IP_Camera
 ip address 192.168.20.1 24
quit

interface Vlanif30
 description To_Router
 ip address 192.168.30.1 24
quit

# è¿æ¥è·¯ç”±å™¨çš„ç«¯å£ï¼ˆç‰©ç†æ¥å£ï¼‰
interface GigabitEthernet0/0/24
 port link-type access
 port default vlan 30
quit

# è¿æ¥æ¥å…¥äº¤æ¢æœºçš„Trunkç«¯å£
interface range GigabitEthernet 0/0/1 to 0/0/2
 port link-type trunk
 port trunk allow-pass vlan 10 20 30  # æ”¾è¡Œä¸šåŠ¡VLANå’Œç®¡ç†VLAN
 port trunk pvid vlan 1  # è®¾ç½®Native VLAN
 storm-control broadcast min-rate 1000  # å¹¿æ’­é£æš´æŠ‘åˆ¶
quit

# è·¯ç”±ä¸å®‰å…¨
ip route-static 0.0.0.0 0 192.168.30.254  # é»˜è®¤è·¯ç”±

acl name PROTECT-CORE
 rule 5 deny tcp destination-port eq 445  # é˜»æ–­SMB
 rule 10 permit ip
interface Vlanif10
 traffic-filter inbound acl name PROTECT-CORE
quit
```

---

### **æ¥å…¥äº¤æ¢æœº1é…ç½® (Huawei S5700) - è¿æ¥PC**
```bash
sysname ACCESS-SW1
vlan batch 10  # åªéœ€åˆ›å»ºæœ¬ç«¯VLAN

# è¿æ¥PCçš„Accessç«¯å£
interface GigabitEthernet0/0/1
 port link-type access
 port default vlan 10
 port-security enable
 port-security max-mac-num 1  # ä¸¥æ ¼MACç»‘å®š
quit

# ä¸Šè”æ ¸å¿ƒçš„Trunkç«¯å£
interface GigabitEthernet0/0/24
 port link-type trunk
 port trunk allow-pass vlan 10
 undo negotiation auto  # å…³é—­è‡ªåŠ¨åå•†
 speed 1000  # å¼ºåˆ¶åƒå…†
quit

# é˜²ç¯è·¯ä¿æŠ¤ï¼ˆæ¥å…¥å±‚å…³é”®é…ç½®ï¼‰
loopback-detect enable
loopback-detect action shutdown  # æ£€æµ‹åˆ°ç¯è·¯è‡ªåŠ¨å…³é—­ç«¯å£
```

---

### **æ¥å…¥äº¤æ¢æœº2é…ç½® (Huawei S5700) - è¿æ¥æ‘„åƒå¤´**
```bash
sysname ACCESS-SW2
vlan batch 20  # æ‘„åƒå¤´ä¸“ç”¨VLAN

# è¿æ¥æ‘„åƒå¤´çš„ç«¯å£
interface GigabitEthernet0/0/1
 port link-type access
 port default vlan 20
 storm-control multicast min-rate 500  # ç»„æ’­æµé‡æŠ‘åˆ¶
quit

# ä¸Šè”æ ¸å¿ƒçš„Trunkç«¯å£ï¼ˆä¸ACCESS-SW1å¯¹ç§°é…ç½®ï¼‰
interface GigabitEthernet0/0/24
 port link-type trunk
 port trunk allow-pass vlan 20
 undo negotiation auto
 speed 1000
quit

# æ‘„åƒå¤´ç½‘ç»œç‰¹æ®Šä¼˜åŒ–
interface Vlanif20
 igmp-snooping enable  # å¯ç”¨ç»„æ’­ä¾¦å¬
quit
```

---

### **è·¯ç”±å™¨å…³é”®é…ç½® (Huawei AR2200)**
```bash
# è¿æ¥æ ¸å¿ƒäº¤æ¢æœºçš„æ¥å£
interface GigabitEthernet0/0/0
 ip address 192.168.30.254 24
quit

# NATå‡ºå£é…ç½®
interface GigabitEthernet0/0/1
 ip address å…¬ç½‘IP æ©ç 
 nat outbound  # å¯ç”¨æºNAT
quit

# å›ç¨‹è·¯ç”±
ip route-static 192.168.10.0 24 192.168.30.1
ip route-static 192.168.20.0 24 192.168.30.1
```

---

### **é…ç½®å¯¹ç…§è¡¨**

| è®¾å¤‡ç±»å‹       | æ ¸å¿ƒåŠŸèƒ½                          | å®‰å…¨é…ç½®                          | ç‰¹æ®Šä¼˜åŒ–                     |
|----------------|----------------------------------|----------------------------------|----------------------------|
| **æ ¸å¿ƒäº¤æ¢æœº** | VLANé—´è·¯ç”±ã€DHCPæœåŠ¡             | ACLè¿‡æ»¤é«˜å±ç«¯å£                  | é£æš´æŠ‘åˆ¶                   |
| **æ¥å…¥äº¤æ¢æœº1** | PCæ¥å…¥                          | ç«¯å£å®‰å…¨(MACç»‘å®š)                | ç¯è·¯æ£€æµ‹                   |
| **æ¥å…¥äº¤æ¢æœº2** | æ‘„åƒå¤´æ¥å…¥                      | ç»„æ’­æµé‡æ§åˆ¶                    | IGMP Snooping             |
| **è·¯ç”±å™¨**     | NATè½¬æ¢ã€é»˜è®¤ç½‘å…³               | é˜²ç«å¢™ç­–ç•¥(éœ€é¢å¤–é…ç½®)          | -                          |

---

### **éªŒè¯å‘½ä»¤æ¸…å•**
1. **æ£€æŸ¥VLANäº’é€šæ€§**ï¼š
   ```bash
   # åœ¨æ ¸å¿ƒäº¤æ¢æœºæ‰§è¡Œï¼š
   ping -a 192.168.10.1 192.168.20.1
   ```

2. **æµ‹è¯•DHCPæœåŠ¡**ï¼š
   ```bash
   display dhcp server ip-in-use vlan 10
   ```

3. **ç›‘æ§ç«¯å£å®‰å…¨**ï¼š
   ```bash
   # åœ¨æ¥å…¥äº¤æ¢æœºæ‰§è¡Œï¼š
   display port-security
   ```

4. **æŸ¥çœ‹è·¯ç”±è¡¨**ï¼š
   ```bash
   display ip routing-table
   ```

---

### **ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ**
1. **æ ¸å¿ƒå±‚**ï¼šé›†ä¸­è·¯ç”±/DHCP/ACLç­–ç•¥ï¼Œé¿å…æ¥å…¥å±‚è®¾å¤‡æ€§èƒ½å‹åŠ›
2. **æ¥å…¥å±‚1**ï¼šä¸¥æ ¼MACç»‘å®šé˜²æ­¢éæ³•æ¥å…¥ï¼Œé€‚åˆåŠå…¬PCç¯å¢ƒ
3. **æ¥å…¥å±‚2**ï¼šä¼˜åŒ–ç»„æ’­ä¼ è¾“ï¼Œé€‚åº”æ‘„åƒå¤´è§†é¢‘æµç‰¹æ€§
4. **ç»Ÿä¸€ç®¡ç†**ï¼šæ‰€æœ‰è®¾å¤‡é€šè¿‡VLAN1ç®¡ç†IPå¯è¾¾ï¼ˆéœ€é¢å¤–é…ç½®ï¼‰

> ğŸ’¡ **ä¼ä¸šç½‘ç»œé»„é‡‘æ³•åˆ™**ï¼šæ ¸å¿ƒåšè·¯ç”±ï¼Œæ¥å…¥åšäº¤æ¢ï¼Œå®‰å…¨ç­–ç•¥åˆ†å±‚éƒ¨ç½²ï¼

:::tip è¿ç»´æç¤º

+ å»ºè®®å¼€å¯æ—¥å¿—æœåŠ¡å™¨åŠŸèƒ½ï¼šinfo-center loghost<br/>
+ æ‘„åƒå¤´ç½‘ç»œå»ºè®®å…³é—­STPï¼šstp disable

:::