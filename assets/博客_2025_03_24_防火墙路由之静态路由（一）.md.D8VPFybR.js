import{_ as p}from"./chunks/WDocTitleMeta.CC0xu2Hf.js";import{_ as k,C as t,c as g,o as e,j as l,G as r,aU as c,a as u,w as b,b as E,e as F}from"./chunks/framework.Bw3asTUr.js";import"./chunks/theme.Dqv5Dpo1.js";const q=JSON.parse('{"title":"防火墙路由之静态路由（一）","description":"","frontmatter":{"firstCommit":"2025-11-08 16:49:57+8:00","lastUpdated":"2025-11-08 16:49:57+8:00","date":"2025/03/24 17:14","isTop":true,"title":"防火墙路由之静态路由（一）","author":"张俊杰","articleGPT":"这是一篇关于","categories":["博客"],"tags":["防火墙路由"]},"headers":[],"relativePath":"博客/2025/03/24/防火墙路由之静态路由（一）.md","filePath":"博客/2025/03/24/防火墙路由之静态路由（一）.md","lastUpdated":1762591797000}'),y={name:"博客/2025/03/24/防火墙路由之静态路由（一）.md"};function m(i,s,v,_,B,C){const d=p,h=t("ClientOnly"),o=t("ArticleGPT");return e(),g("div",null,[s[0]||(s[0]=l("h1",{id:"防火墙路由之静态路由-一",tabindex:"-1"},[u("防火墙路由之静态路由（一） "),l("a",{class:"header-anchor",href:"#防火墙路由之静态路由-一","aria-label":'Permalink to "防火墙路由之静态路由（一）"'},"​")],-1)),r(h,null,{default:b(()=>{var a,n;return[(((a=i.$frontmatter)==null?void 0:a.aside)??!0)&&(((n=i.$frontmatter)==null?void 0:n.showWDocTitleMeta)??!0)?(e(),E(d,{key:0,article:i.$frontmatter},null,8,["article"])):F("",!0)]}),_:1}),r(o),s[1]||(s[1]=c(`<h3 id="一、路由表结构总览" tabindex="-1"><strong>一、路由表结构总览</strong> <a class="header-anchor" href="#一、路由表结构总览" aria-label="Permalink to &quot;**一、路由表结构总览**&quot;">​</a></h3><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-R9u-l" id="tab-kWwAtrQ" checked><label data-title="查看静态路由表命令： get router info routing-table details" for="tab-kWwAtrQ">查看静态路由表命令： get router info routing-table details</label></div><div class="blocks"><div class="language-shell vp-adaptive-theme active line-numbers-mode"><button title="复制代码" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  0.0.0.0/0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                 [10/0] via 222.178.157.65, port2, [1/0]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 [10/0] </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">via</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 183.230.155.1,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> port1,</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [2/0]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  10.253.132.0/23</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     [1/0] via hengan-dx tunnel 202.109.209.46, [1/0]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 [1/0] </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">via</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hengan-yd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tunnel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 36.249.61.66,</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [1/0]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  172.18.20.0/23</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       [1/0] via hengan-dx tunnel 202.109.209.46, [1/0]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 [1/0] </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">via</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hengan-yd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tunnel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 36.249.61.66,</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [1/0]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  192.168.0.0/16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       [1/0] via hengan-dx tunnel 202.109.209.46, [1/0]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 [1/0] </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">via</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hengan-yd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tunnel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 36.249.61.66,</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [1/0]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  192.168.251.12/30</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [5/0] via hengan-dx tunnel 202.109.209.46, [1/0]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  192.168.252.12/30</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [5/0] via hengan-yd tunnel 36.249.61.66, [1/0]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></div></div><hr><h4 id="解析静态路由表" tabindex="-1"><strong>解析静态路由表</strong> <a class="header-anchor" href="#解析静态路由表" aria-label="Permalink to &quot;**解析静态路由表**&quot;">​</a></h4><p>路由表的一般格式如下：</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="复制代码" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">网络地址/掩码</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [管理距离/度量值] via 出口接口 目标网关IP, [管理距离/度量值]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><strong>网络地址/掩码</strong>：目标子网</li><li><strong>管理距离</strong>（Administrative Distance, AD）：决定多个路由的优先级，数值越小优先级越高</li><li><strong>度量值</strong>（Metric）：用于度量路由的开销，通常 OSPF、BGP 等动态路由协议使用</li><li><strong>via 出口接口</strong>：流量要通过哪个接口出去</li><li><strong>目标网关 IP</strong>：数据包应该转发到的下一跳地址</li></ul><hr><div class="tip custom-block"><p class="custom-block-title">您的路由表包含三类核心条目：</p><ol><li><strong>默认路由</strong>（0.0.0.0/0）——处理所有非本地流量。</li><li><strong>特定子网路由</strong>（如10.253.132.0/23）——指向VPN隧道的专用路径。</li><li><strong>点对点路由</strong>（如192.168.251.12/30）——维持隧道端点间通信。</li></ol></div><h3 id="二、分析你的路由" tabindex="-1"><strong>二、分析你的路由</strong> <a class="header-anchor" href="#二、分析你的路由" aria-label="Permalink to &quot;**二、分析你的路由**&quot;">​</a></h3><h4 id="_1-默认路由-双isp出口冗余" tabindex="-1"><strong>1. 默认路由：双ISP出口冗余</strong> <a class="header-anchor" href="#_1-默认路由-双isp出口冗余" aria-label="Permalink to &quot;**1. 默认路由：双ISP出口冗余**&quot;">​</a></h4><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="复制代码" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">0.0.0.0/0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                 [10/0] via 222.178.134.65, port2, [1/0]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                          [10/0] </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">via</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 183.230.134.1,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> port1,</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [2/0]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><strong>字段拆解</strong>：</li><li><strong>0.0.0.0/0</strong> 代表默认路由，适用于所有无法匹配其他规则的流量。</li><li><strong>两个出站路径：</strong><ul><li><code>222.178.157.65</code> 通过 <code>port2</code>（优先级 <code>[1/0]</code>）。</li><li><code>183.230.155.1</code> 通过 <code>port1</code>（优先级 <code>[2/0]</code>）。</li></ul></li><li><strong>管理距离（Administrative Distance，AD）为 <code>10</code></strong>，表明这是一条手动配置的静态路由。</li><li><strong>度量值（Metric）分别为 <code>1</code> 和 <code>2</code></strong>，日常流量全走<code>port2</code> ,<code>port2</code>故障时15秒内切<code>port1</code></li></ul><h4 id="_1-10-253-132-0-23" tabindex="-1"><strong>1. 10.253.132.0/23</strong> <a class="header-anchor" href="#_1-10-253-132-0-23" aria-label="Permalink to &quot;**1. 10.253.132.0/23**&quot;">​</a></h4><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="复制代码" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  10.253.132.0/23</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     [1/0] via hengan-dx tunnel 202.109.209.46, [1/0]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 [1/0] </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">via</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hengan-yd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tunnel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 36.249.61.66,</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [1/0]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  172.18.20.0/23</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       [1/0] via hengan-dx tunnel 202.109.209.46, [1/0]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 [1/0] </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">via</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hengan-yd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tunnel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 36.249.61.66,</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [1/0]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  192.168.0.0/16</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       [1/0] via hengan-dx tunnel 202.109.209.46, [1/0]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                                 [1/0] </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">via</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hengan-yd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tunnel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 36.249.61.66,</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [1/0]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_2-核心子网走向" tabindex="-1"><strong>2. 核心子网走向</strong> <a class="header-anchor" href="#_2-核心子网走向" aria-label="Permalink to &quot;**2. 核心子网走向**&quot;">​</a></h4><table tabindex="0"><thead><tr><th><strong>目标网络</strong></th><th><strong>传输路径</strong></th><th><strong>特点</strong></th></tr></thead><tbody><tr><td><code>10.253.132.0/23</code></td><td>双隧道: <code>hengan-dx</code> / <code>hengan-yd</code></td><td>自动负载均衡/故障切换</td></tr><tr><td><code>172.18.20.0/23</code></td><td>同上</td><td>业务系统专用通道</td></tr><tr><td><code>192.168.0.0/16</code></td><td>同上</td><td>覆盖所有192.168.x.x流量</td></tr></tbody></table><p>📌 <strong>说明</strong>：<br> 该网络的流量可以走 <code>hengan-dx</code> 或 <code>hengan-yd</code>，这通常用于<strong>双链路备份</strong>，如果 <code>hengan-dx</code> 断开，流量会自动切换到 <code>hengan-yd</code>。 如果你的网络中有多个 <code>192.168.x.x</code> 段，这意味着<strong>所有这些私有网络的流量都会通过 VPN 隧道传输</strong>。</p><h4 id="_3-隧道管理走向" tabindex="-1"><strong>3. 隧道管理走向</strong> <a class="header-anchor" href="#_3-隧道管理走向" aria-label="Permalink to &quot;**3. 隧道管理走向**&quot;">​</a></h4><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="复制代码" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">S</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       192.168.251.12/30</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [5/0] via hengan-dx tunnel 202.109.209.46, [1/0]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">S</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">       192.168.252.12/30</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [5/0] via hengan-yd tunnel 36.249.61.66, [1/0]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>目标网络 <code>192.168.251.12/30</code>（子网范围很小，通常用于点对点连接，如 VPN 隧道接口）</li><li><strong>管理距离是 <code>5</code>，低于其他路由（管理距离 <code>1</code>），因此它的优先级更低</strong></li></ul><p>📌 <strong>说明</strong>：</p><blockquote><p>192.168.251.12/30 → 强制走 hengan-dx (低优先级)<br> 192.168.252.12/30 → 强制走 hengan-yd (低优先级)</p></blockquote><h3 id="总结" tabindex="-1"><strong>总结</strong> <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;**总结**&quot;">​</a></h3><ol><li><p><strong>你有两条主隧道：<code>hengan-dx</code> 和 <code>hengan-yd</code></strong></p><ul><li>主要流量（<code>10.253.132.0/23</code>、<code>172.18.20.0/23</code>、<code>192.168.0.0/16</code>）会走 <strong>两条隧道</strong>，用于负载均衡或备份。</li><li>这些路由的<strong>管理距离是 <code>1</code></strong>，优先级较高，保证流量优先使用这些路径。</li></ul></li><li><p><strong>你有两个备用路由：<code>192.168.251.12/30</code> 和 <code>192.168.252.12/30</code></strong></p><ul><li>这两个路由的<strong>管理距离是 <code>5</code></strong>，优先级低，可能是用于某些特定业务的备用路径。</li></ul></li><li><p><strong>如果 <code>hengan-dx</code> 失效，流量会自动切换到 <code>hengan-yd</code>，反之亦然。</strong></p></li></ol><ul><li>如果启用了 <strong>SD-WAN</strong>，你应该检查 SD-WAN 规则是否影响了流量分配。</li></ul><hr><hr><h3 id="_1-路由优先级匹配规则" tabindex="-1"><strong>1. 路由优先级匹配规则</strong> <a class="header-anchor" href="#_1-路由优先级匹配规则" aria-label="Permalink to &quot;**1. 路由优先级匹配规则**&quot;">​</a></h3><p>在 FortiGate 的路由表中，<strong>前后顺序没有直接关系</strong>，真正决定路由优先级的因素是<strong>管理距离（Administrative Distance, AD）</strong> 和 <strong>子网掩码（前缀长度）</strong>，它们按照下面的规则进行匹配：</p><h4 id="_1-最精确匹配-最长前缀匹配" tabindex="-1"><strong>（1）最精确匹配（最长前缀匹配）</strong> <a class="header-anchor" href="#_1-最精确匹配-最长前缀匹配" aria-label="Permalink to &quot;**（1）最精确匹配（最长前缀匹配）**&quot;">​</a></h4><ul><li><strong>优先选择子网掩码最长的路由</strong>（即范围最小、最精确的路由）。</li><li>例如： <ul><li><code>192.168.1.0/24</code>（掩码 255.255.255.0）</li><li><code>192.168.1.0/26</code>（掩码 255.255.255.192）</li><li><strong><code>/26</code> 更精确，所以它的优先级更高</strong>，即使 <code>/24</code> 的管理距离更低。</li></ul></li></ul><p>📌 <strong>结论</strong>：<br><strong>更精确的路由会优先使用，即使它的管理距离较高！</strong></p><hr><h4 id="_2-管理距离-administrative-distance-ad" tabindex="-1"><strong>（2）管理距离（Administrative Distance, AD）</strong> <a class="header-anchor" href="#_2-管理距离-administrative-distance-ad" aria-label="Permalink to &quot;**（2）管理距离（Administrative Distance, AD）**&quot;">​</a></h4><ul><li><strong>如果多个路由匹配相同的目标网络，优先选择管理距离较低的路由。</strong></li><li><strong>管理距离（AD）值越小，优先级越高。</strong><br> 常见的管理距离：<table tabindex="0"><thead><tr><th>路由类型</th><th>管理距离</th></tr></thead><tbody><tr><td>直连路由（Connected）</td><td>0</td></tr><tr><td>静态路由（Static）</td><td>1</td></tr><tr><td>OSPF</td><td>110</td></tr><tr><td>BGP 外部（eBGP）</td><td>20</td></tr><tr><td>BGP 内部（iBGP）</td><td>200</td></tr><tr><td>RIP</td><td>120</td></tr><tr><td>策略路由（Policy Route）</td><td>特殊情况</td></tr></tbody></table></li></ul><p>📌 <strong>结论</strong>：<br><strong>如果多个路由的前缀长度相同，管理距离最小的路由被优先使用！</strong></p><hr><h4 id="_3-度量值-metric" tabindex="-1"><strong>（3）度量值（Metric）</strong> <a class="header-anchor" href="#_3-度量值-metric" aria-label="Permalink to &quot;**（3）度量值（Metric）**&quot;">​</a></h4><ul><li><strong>如果多个路由的前缀长度和管理距离都相同，则比较“度量值”（Metric），度量值越小优先级越高。</strong></li><li>在静态路由中，度量值通常为 0，不会影响选择，但在 OSPF、BGP 等动态路由协议中，度量值是重要的因素。</li></ul><p><strong>度量值仅在前缀长度和管理距离都相同时才会影响路由选择！</strong></p><p>按照优先级排序：</p><ol><li><code>192.168.251.12/30</code> 和 <code>192.168.252.12/30</code> → <strong>更精确</strong>，但管理距离 <code>5</code>，优先级低</li><li><code>10.253.132.0/23</code>、<code>172.18.20.0/23</code>、<code>192.168.0.0/16</code> → <strong>管理距离 <code>1</code>，优先级高</strong></li></ol><h3 id="_2-结论" tabindex="-1"><strong>2. 结论</strong> <a class="header-anchor" href="#_2-结论" aria-label="Permalink to &quot;**2. 结论**&quot;">​</a></h3><p>✅ <strong>前后顺序无关紧要，真正影响路由选择的是：</strong></p><ol><li><strong>子网掩码（前缀长度），更精确的路由优先</strong></li><li><strong>管理距离（Administrative Distance, AD），数值越小优先级越高</strong></li><li><strong>度量值（Metric），如果前缀长度和管理距离都相同，度量值小的优先</strong></li></ol><p><strong>因此，你的路由表里即使 <code>192.168.251.12/30</code> 在 <code>192.168.0.0/16</code> 之后，它仍然会被优先匹配，因为 <code>/30</code> 比 <code>/16</code> 更精确。</strong></p>`,47))])}const A=k(y,[["render",m]]);export{q as __pageData,A as default};
