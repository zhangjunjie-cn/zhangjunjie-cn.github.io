import{_ as c}from"./chunks/WDocTitleMeta.BmZDjHCj.js";import{_ as o,C as p,c as A,o as t,j as r,G as i,aU as h,a as g,w as k,b as C,e as b}from"./chunks/framework.UOXOyoov.js";import"./chunks/theme.BUm-IbPM.js";const N=JSON.parse('{"title":"非OSPF的子网互通场景","description":"核心三层交换机 是这两个VLAN的网关。它自己就直连着这两个网段。我想知道其配置，我的意思是，核心下面有几台办公网的汇聚，vlan有几台交换机，但他们的网关是在核心交换机的，那核心以及下面的汇聚交换机的vlan及其ip等等的各种配置，如何配置","frontmatter":{"title":"非OSPF的子网互通场景","description":"核心三层交换机 是这两个VLAN的网关。它自己就直连着这两个网段。我想知道其配置，我的意思是，核心下面有几台办公网的汇聚，vlan有几台交换机，但他们的网关是在核心交换机的，那核心以及下面的汇聚交换机的vlan及其ip等等的各种配置，如何配置","firstCommit":"2025-11-16 15:23","lastUpdated":"2025-11-16 15:23","tags":["network"]},"headers":[],"relativePath":"笔记/network/非OSPF的子网场景.md","filePath":"笔记/network/非OSPF的子网场景.md","lastUpdated":1763307931000}'),E={name:"笔记/network/非OSPF的子网场景.md"};function B(a,s,u,y,m,D){const F=c,n=p("ClientOnly"),d=p("MermaidChart");return t(),A("div",null,[s[0]||(s[0]=r("h1",{id:"非ospf的子网互通场景",tabindex:"-1"},[g("非OSPF的子网互通场景 "),r("a",{class:"header-anchor",href:"#非ospf的子网互通场景","aria-label":'Permalink to "非OSPF的子网互通场景"'},"​")],-1)),i(n,null,{default:k(()=>{var l,e;return[(((l=a.$frontmatter)==null?void 0:l.aside)??!0)&&(((e=a.$frontmatter)==null?void 0:e.showWDocTitleMeta)??!0)?(t(),C(F,{key:0,article:a.$frontmatter},null,8,["article"])):b("",!0)]}),_:1}),s[1]||(s[1]=h(`<p>好的，您描述的这个场景非常经典，这就是典型的三层核心、二层接入的网络架构。我们来彻底讲清楚这个结构的配置逻辑。</p><p>为了让您彻底理解，我将分三步讲解：</p><ol><li><strong>核心思想与数据流</strong></li><li><strong>详细配置命令示例</strong></li><li><strong>配置逻辑总结图</strong></li></ol><hr><h3 id="第一步-核心思想与数据流" tabindex="-1">第一步：核心思想与数据流 <a class="header-anchor" href="#第一步-核心思想与数据流" aria-label="Permalink to &quot;第一步：核心思想与数据流&quot;">​</a></h3><p>在您的架构中：</p><ul><li><strong>核心交换机</strong>：扮演“总指挥部”的角色，是所有VLAN的网关。它负责所有<strong>跨VLAN的通信</strong>（三层路由）。</li><li><strong>汇聚/接入交换机</strong>：扮演“地方车站”的角色，只负责将设备（PC、打印机、AP）接入到正确的VLAN（二层交换），并把需要跨VLAN的流量送往“总指挥部”。</li></ul><p><strong>一个数据包的旅程（WiFi手机访问有线打印机）：</strong></p><ol><li>手机（<code>VLAN 20</code>， <code>192.168.20.100</code>）要访问打印机（<code>VLAN 10</code>， <code>192.168.10.10</code>）。</li><li>手机发现目标IP不在同一网段，将数据包发给它的网关——<strong>核心交换机</strong>的VLAN 20接口（<code>192.168.20.1</code>）。</li><li>接入交换机通过打了VLAN 20标签的Trunk口，将数据包送上核心交换机。</li><li><strong>核心交换机</strong>收到数据包，进行路由查询： “目标 <code>192.168.10.10</code> 是我的直连网段 <code>192.168.10.0/24</code>（VLAN 10）”。</li><li>核心交换机将数据包从VLAN 10的接口转发出去。</li><li>数据包再通过打了VLAN 10标签的Trunk口，到达打印机所在的接入交换机，并最终送达打印机。</li></ol><p><strong>关键在于：汇聚和接入交换机不负责做路由决策，它们只负责在正确的VLAN内传输数据。</strong></p><hr><h3 id="第二步-详细配置命令示例" tabindex="-1">第二步：详细配置命令示例 <a class="header-anchor" href="#第二步-详细配置命令示例" aria-label="Permalink to &quot;第二步：详细配置命令示例&quot;">​</a></h3><p>我们以<strong>华为/华三/锐捷</strong>等通用命令风格为例（思科命令逻辑类似）。假设：</p><ul><li><strong>VLAN 10</strong>： 有线网络，网段 <code>192.168.10.0/24</code>，网关 <code>192.168.10.1</code></li><li><strong>VLAN 20</strong>： 无线网络，网段 <code>192.168.20.0/24</code>，网关 <code>192.168.20.1</code></li><li><strong>核心交换机</strong>与<strong>汇聚交换机</strong>之间使用 <code>G1/0/1</code> 互联。</li></ul><h4 id="_1-核心交换机配置" tabindex="-1">1. 核心交换机配置 <a class="header-anchor" href="#_1-核心交换机配置" aria-label="Permalink to &quot;1. 核心交换机配置&quot;">​</a></h4><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="复制代码" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建所需VLAN</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">system-view</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vlan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> batch</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置与汇聚交换机连接的物理接口为Trunk模式，并允许所有VLAN通过（或指定VLAN）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">interface</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GigabitEthernet</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 1/0/1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> port</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> link-type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> trunk</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> port</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> trunk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> allow-pass</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vlan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> all</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 或者 port trunk allow-pass vlan 10 20</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建VLAN接口（即虚拟网关接口），并配置IP地址</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">interface</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Vlanif</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> address</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.10.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 255.255.255.0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 这就是VLAN 10的网关</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> description</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> For-Wired-Network</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">interface</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Vlanif</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> address</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.20.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 255.255.255.0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 这就是VLAN 20的网关</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> description</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> For-Wireless-Network</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># （可选但重要）配置一条默认路由，指向出口防火墙/路由器，用于上网</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> route-static</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0.0.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0.0.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.1.1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 假设出口网关是192.168.1.1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><strong>核心交换机的配置就完成了！它现在已经准备好为VLAN 10和20做路由了。</strong></p><h4 id="_2-汇聚交换机-接入交换机配置" tabindex="-1">2. 汇聚交换机/接入交换机配置 <a class="header-anchor" href="#_2-汇聚交换机-接入交换机配置" aria-label="Permalink to &quot;2. 汇聚交换机/接入交换机配置&quot;">​</a></h4><p>汇聚交换机的主要任务是透传VLAN。</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="复制代码" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建需要在本交换机上使用的VLAN（通常和核心保持一致）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">system-view</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vlan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> batch</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置上联核心的接口为Trunk模式</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">interface</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GigabitEthernet</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 1/0/48</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 假设这是上联口</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> port</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> link-type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> trunk</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> port</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> trunk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> allow-pass</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vlan</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> all</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # 允许必要的VLAN通过</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 配置下联接入层设备（PC、打印机、AP）的接口</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 接有线打印机（属于VLAN 10）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">interface</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GigabitEthernet</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 1/0/1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> port</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> link-type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> access</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # 接口模式为Access</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> port</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> default</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vlan</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 将接口划入VLAN 10</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 接无线AP（AP的管理VLAN属于VLAN 20，AP发出的用户业务流量也由VLAN 20承载）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">interface</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> GigabitEthernet</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 1/0/2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> port</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> link-type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> access</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> port</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> default</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vlan</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如果AP本身需要管理VLAN，而业务是另一个VLAN，则上联口需配置为Hybrid或Trunk，此处略复杂，按简单场景处理。</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><hr><h3 id="第三步-配置逻辑总结图" tabindex="-1">第三步：配置逻辑总结图 <a class="header-anchor" href="#第三步-配置逻辑总结图" aria-label="Permalink to &quot;第三步：配置逻辑总结图&quot;">​</a></h3><p>下图清晰地展示了整个网络的数据流向与配置逻辑，说明了为何核心交换机是网关，以及流量如何跨越VLAN：</p>`,23)),i(n,null,{default:k(()=>[i(d,{code:"flowchart%20TD%0A%20%20%20%20subgraph%20Core%5B%E6%A0%B8%E5%BF%83%E4%BA%A4%E6%8D%A2%E6%9C%BA%5D%0A%20%20%20%20%20%20%20%20C1%5BVLANIF10%3Cbr%3E192.168.10.1%2F24%5D%0A%20%20%20%20%20%20%20%20C2%5BVLANIF20%3Cbr%3E192.168.20.1%2F24%5D%0A%20%20%20%20end%0A%0A%20%20%20%20C1%20%26%20C2%20--%3E%20C_Trunk%5BG1%2F0%2F1%3Cbr%3EPort%20link-type%20trunk%3Cbr%3EAllow-pass%20vlan%2010%2C20%5D%0A%0A%20%20%20%20C_Trunk%20--%3E%20A_Trunk%5BG1%2F0%2F48%3Cbr%3EPort%20link-type%20trunk%3Cbr%3EAllow-pass%20vlan%2010%2C20%5D%0A%0A%20%20%20%20subgraph%20Access%5B%E6%B1%87%E8%81%9A%2F%E6%8E%A5%E5%85%A5%E4%BA%A4%E6%8D%A2%E6%9C%BA%5D%0A%20%20%20%20%20%20%20%20A_Trunk%0A%20%20%20%20%20%20%20%20A_Access1%5BG1%2F0%2F1%3Cbr%3EPort%20link-type%20access%3Cbr%3EPort%20default%20vlan%2010%5D%0A%20%20%20%20%20%20%20%20A_Access2%5BG1%2F0%2F2%3Cbr%3EPort%20link-type%20access%3Cbr%3EPort%20default%20vlan%2020%5D%0A%20%20%20%20end%0A%0A%20%20%20%20A_Access1%20--%3E%20%7CPVID%2010%7C%20Printer%5B%E6%9C%89%E7%BA%BF%E6%89%93%E5%8D%B0%E6%9C%BA%3Cbr%3EIP%3A%20192.168.10.10%2F24%3Cbr%3EGW%3A%20192.168.10.1%5D%0A%20%20%20%20A_Access2%20--%3E%20%7CPVID%2020%7C%20AP%5B%E6%97%A0%E7%BA%BFAP%5D%0A%20%20%20%20AP%20--%3E%20Phone%5BWiFi%E6%89%8B%E6%9C%BA%3Cbr%3EIP%3A%20192.168.20.100%2F24%3Cbr%3EGW%3A%20192.168.20.1%5D%0A%0A%20%20%20%20Phone%20--%20%E2%80%9C%E8%AE%BF%E9%97%AE%20192.168.10.10%E2%80%9D%20--%3E%20AP%0A%20%20%20%20AP%20--%20%E2%80%9CVLAN%2020%20%E6%95%B0%E6%8D%AE%E2%80%9D%20--%3E%20A_Access2%0A%20%20%20%20Access%20--%20%E2%80%9CTrunk%E6%90%BA%E5%B8%A6VLAN%2020%E6%A0%87%E7%AD%BE%E2%80%9D%20--%3E%20Core%0A%20%20%20%20Core%20--%20%E2%80%9C%E8%B7%AF%E7%94%B1%3A%20VLAN%2020%20-%3E%20VLAN%2010%E2%80%9D%20--%3E%20Core%0A%20%20%20%20Core%20--%20%E2%80%9CTrunk%E6%90%BA%E5%B8%A6VLAN%2010%E6%A0%87%E7%AD%BE%E2%80%9D%20--%3E%20Access%0A%20%20%20%20Access%20--%20%E2%80%9CVLAN%2010%20%E6%95%B0%E6%8D%AE%E2%80%9D%20--%3E%20A_Access1%0A%20%20%20%20A_Access1%20--%3E%20Printer%0A",showToolbar:"1"})]),_:1}),s[2]||(s[2]=h('<h3 id="最终确认" tabindex="-1">最终确认 <a class="header-anchor" href="#最终确认" aria-label="Permalink to &quot;最终确认&quot;">​</a></h3><p>按照上述方式配置后：</p><ul><li><strong>手机</strong>的IP地址应由AC/DHCP服务器分配为 <code>192.168.20.x/24</code>，网关为 <code>192.168.20.1</code>。</li><li><strong>打印机</strong>的IP地址应手动设置为 <code>192.168.10.x/24</code>，网关为 <code>192.168.10.1</code>。</li></ul><p>完成以上步骤，它们之间就可以正常通信了。这种架构下，<strong>完全不需要OSPF</strong>，因为所有VLAN的网关都在同一台设备上，路由是“直连”的。</p>',4))])}const f=o(E,[["render",B]]);export{N as __pageData,f as default};
